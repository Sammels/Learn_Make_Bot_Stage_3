Телеграмм бот, стадия 3
13.7 Версия сломана кхренам.
инсталим 12.6.1 [socks]
пущай лучше так.

# Берем исходник 2-й версии, и рефакторим.

Клавиатурные боты, самые расспространенные боты при нажатиии на клавишу
написанный  на клавиатуре  текст отправляется в чат.

## Для создания клавиатуры импортим
ReplyKeyboardMarkup

`from telegram import ReplyKeyboardMarkup`


## Разметка клавиатуры

Список, внутри которого несколько списков в названии клавиш.
Нулевой список это верхний ряд клавиатуры.
Первый второй ряд, и так далеее.

```[
['Баланс','Тарифы'],
['Возможности при нуле'],
['Услуги и скидки','МТС Бонус']
]
```

При нажатии на кнопку в чат отправляется текст.
 И дальше мы работаем с ним как стекстом.

### Добавим клавиатуру в greet_user

Добавим клавиатуру с одной кнопкой которая будет отсылать в чат команду /cat

```def greet_user(update, context):
  context.user_data['emoji'] = get_smile(context.user_data)
  my_keyboard = ReplyKeyboardMarkup([['/cat']])
  update.message.reply_text(
    f"Добрый день, пользователь{context.user_data['emoji']}!",
    reply_markup=my_keyboard
    )
```


## Рефактор, изменение /cat на "Прислать котика"

```def greet_user(update, context):
  context.user_data['emoji'] = get_smile(context.user_data)
  my_keyboard = ReplyKeyboardMarkup([['Прислать котика']])
  update.message.reply_text(
    f"Добрый день, пользователь{context.user_data['emoji']}!",
    reply_markup=my_keyboard
    )
```

Нужно сделать, когда в чат приходит сообщение прислать котика, вызывается сообщение.
Чтобы научить бота реагировать на определенный текст в чате мы использует регулярные выражения
Это мощный инструмент для поиска строк и проверки их на соответствие какому либо шаблону.



## Добавим обработчик

Используем самый простой шаблон 
`^ - начало строки`
`() - значение то на что должна реагировать команда`
`$ - конец строки`

Более частный более конкретный handler нужно ставить выше более общего.


Внесем формирование клавиатуры в функцию

Добавлять в каждую функцию-обработчик строку формирования клавиатуры - плохая идея.
Вынесем формирование клавиатуры в отдельную функцию
```
def main_keyboard():
    return ReplyKeyboardMarkup([['Прислать котика']])
```

Добавить вызов функции в тот ког который выдает рузультаты
Если код повторно используется, его необходимо вывести в функцию.

## Получение геолокации пользователя

В ТГ можно запросить геопозицию.
Для этого необходимо добавить на клавиатуру специальную кнопку.
Импортируем класс KeyboardButtom, который может добавить специальную кнопку геолокации.

`from telegram import ReplyKeyboardMarkmup, KeyboardButton`

Эта кнопка работает только с телефона, и при работе  с ТГ на компе  можно отправить координаты через меню.

Добавим эту кнопку на клавиатуру.
Модифицирем main_keyboard()

```
def main_keyoard():
  return ReplyKeyboardMatkup([
          ['Прислать котика', KeyboardButton('Мои координаты', request_location=True)]
          ])
```

## Добавим обработчик для этих данных
Для того, чтобы настроить обработчик именно на геокоординаты, используем `Filters.location`

`dp.add_handler(MessageHandler(Filters.location, user_coordinates))`


## Опишем функцию user_coordinates
````

def user_coordinates(update, context):
    context.user_data['emoji'] = get_smile(context.user_data)
    coords = update.message.location
    update.message.reply_text(
        f"Ваши координаты {coords} {context.user_data['emoji']}!",
        reply_markup=main_keyboard()
        )
````

# Рефакторинг
Рефакторинг - улучшение кода без изменения его пользовательского функционала.
Делается чтобы с кодом было удобно работать, улучшаем дизайн нашего проекта.


# README.md
Документирование проекта - признак его качества.
Самые распространненые форматы Markdown, reStructuredText

# Пример 
# Проект Учебный бот (Главный заголовок)

Учебный бот стадия 3 - это бот для Telegram и показывает пользователю котиков.

## Установка (Заголовок меньше Главного)

1. Клонируйте репозиторий с github
2. Создайте виртуальное окружение
3. Установите зависимости `pip install -r requirements.txt`
4. Создайте файл `settings.py`
5. Впишите в settings.py переменные:
```
API_KEY = "API"
PROXY_URL = "Proxy:port"
PROXY_USERNAME = "Username"
PROXY_PASSWORD = "SuperPassword"
USER_EMOJI = [':smiley_cat:',':smiling_imp:',':panda_face:',':dog:']
``` 
6. Запустите бота коммандой `python3.8 bot3.py`
